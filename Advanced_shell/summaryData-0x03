#!/bin/bash

# pokemon_report - Summarize Pokémon data from JSON files
# This script reads JSON files, extracts Pokémon data, and generates a CSV report

# Output CSV file
OUTPUT_FILE="pokemon_report.csv"

# Create CSV header
echo "Name,Height (m),Weight (kg)" > "$OUTPUT_FILE"

# Find all JSON files (assuming they're in the current directory)
# Adjust the path if your JSON files are in a different location
for json_file in *.json; do
    # Check if any JSON files exist
    if [ ! -f "$json_file" ]; then
        echo "No JSON files found in the current directory."
        exit 1
    fi
    
    # Extract name, height, and weight from JSON using sed
    # Height is in decimeters in the API, convert to meters (divide by 10)
    # Weight is in hectograms in the API, convert to kg (divide by 10)
    name=$(sed -n 's/.*"name":"\([^"]*\)".*/\1/p' "$json_file" | head -1)
    height=$(sed -n 's/.*"height":\([0-9]*\).*/\1/p' "$json_file")
    weight=$(sed -n 's/.*"weight":\([0-9]*\).*/\1/p' "$json_file")
    
    # Convert height from decimeters to meters and weight from hectograms to kg
    if [ -n "$name" ] && [ -n "$height" ] && [ -n "$weight" ]; then
        height_m=$(echo "scale=1; $height / 10" | bc)
        weight_kg=$(echo "scale=1; $weight / 10" | bc)
        
        # Append to CSV file
        echo "$name,$height_m,$weight_kg" >> "$OUTPUT_FILE"
    fi
done

# Display success message
echo "CSV Report generated at: $OUTPUT_FILE"
echo ""

# Display the CSV content
cat "$OUTPUT_FILE"
echo ""

# Calculate average height and weight using awk
awk -F',' '
NR > 1 {  # Skip header row
    sum_height += $2
    sum_weight += $3
    count++
}
END {
    if (count > 0) {
        avg_height = sum_height / count
        avg_weight = sum_weight / count
        printf "Average Height: %.2f m\n", avg_height
        printf "Average Weight: %.2f kg\n", avg_weight
    }
}' "$OUTPUT_FILE"
